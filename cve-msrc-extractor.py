#!/usr/bin/python3

import sys,requests

def cvelistlines(cvelists):
	cve_lists = []
	for cvelist in cvelists:

		url = "https://api.msrc.microsoft.com/sug/v2.0/en-US/vulnerability/" + cvelist
		response = requests.get(url)
		if (response.status_code != 404):
			json_data = requests.get(url).json()
			result_date = json_data['releaseDate'].split('T')[0]
			print("CVE:    " + cvelist + " - " + result_date)
			cve_info = cvelist + ","+ result_date

		else:
			cve_info = cvelist + ","+ "N/A"

		cve_lists.append(cve_info)
	return cve_lists

input_file = sys.argv[1]
output_file = sys.argv[2]


print ("[+]	Microsoft CVE Patch Published Date are being extracted from MSRC API")
print ("[+]	All N/A dates result in CSV file are not Microsoft CVEs.")
print ("[+]	Please wait until it is finished...")

lines = open(input_file, 'r').readlines()
lines = [line.strip() for line in lines]
cve_info_list = cvelistlines(lines)

open_output = open(output_file, 'w')

for cve in cve_info_list:
	open_output.write(cve)
	open_output.write('\n')

print ("[+]	Done!")